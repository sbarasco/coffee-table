!function(t,e){"use strict";t.JSONFormData=function(e,o){return t.console||(t.console.log=t.console.warn=function(){}),"application/json"===e.getAttribute("enctype")?this.initialize(e,o):void console.warn("Wrong form enctype!")},JSONFormData.prototype.initialize=function(t,e){var o=this,a=t.elements;this.form=t,this.enctype="application/json",this.action=t.action,this.method=this.getMethod(),this.formData={},e?this.form.addEventListener("submit",function(t){t.preventDefault(),o.extractValues(a,function(){var t,a,n=new XMLHttpRequest;"get"===o.method&&(a=o.toUrlEncoded(o.formData)),t=a?o.action+"?"+a:o.action,n.open(o.method,t),n.setRequestHeader("Content-Type",o.enctype),n.addEventListener("loadend",function(){200!==this.status?e({code:this.status,message:this.statusText}):e(null,this.response)},!1),n.send(a?null:JSON.stringify(o.formData))})},!1):o.extractValues(a)},JSONFormData.prototype.accessorType=function(t){return"[]"===t||"number"==typeof t&&t%1===0?"array":"object"},JSONFormData.prototype.putFormData=function(t,e,o){var a,n=this,r=/\[(.*?)]/g,i=[],s=t.match(/(.+?)\[/);for(s=null===s?t:s[1],e="number"===o?parseInt(e,10):e;a=r.exec(t);){var f=parseInt(a[1],10);""===a[1]?i.push("[]"):f==a[1]?i.push(f):i.push(a[1])}if(i.length>0){var c,p=i[0],l=n.accessorType(i[0]);"undefined"==typeof n.formData[s]?"object"===l?n.formData[s]={}:n.formData[s]=[]:"object"!=typeof n.formData[s]&&(n.formData[s]={"":n.formData[s]}),c=n.formData[s];for(var u=0;u<i.length-1;u++)l=n.accessorType(i[u+1]),p=i[u],"undefined"==typeof c[p]&&("object"===l?c[p]={}:c[p]=[]),"object"!=typeof c[p]&&u<i.length-1&&(c[p]={"":c[p]}),c=c[p];var m=i[i.length-1];"[]"===m?c.push(e):"undefined"==typeof c[m]?c[m]=e:c[m]instanceof Array?c[m].push(e):c[m]=[c[m],e]}else"undefined"==typeof n.formData[s]?n.formData[s]=e:n.formData[s]instanceof Array?n.formData[s].push(e):n.formData[s]=[n.formData[s],e]},JSONFormData.prototype.extractValues=function(t,e){var o=this,a=t.length-1,n=!1,r=null,i=!1,s=!1;o.formData={},[].forEach.call(t,function(t,f){r=f,i="checkbox"===t.type||"radio"===t.type,s="button"===t.type||"reset"===t.type||"submit"===t.type||"button"===t.nodeName.toLowerCase(),s||t.disabled||("file"===t.type&&t.files.length?(n=!0,o.fileToJSON(t.files,t.name,function(t){t&&console.warn(t.message),r===a&&e&&e()})):"select-multiple"===t.type?[].forEach.call(t.selectedOptions,function(e){o.putFormData(t.name+"[]",e.value,t.type)}):(!i||i&&t.checked)&&o.putFormData(t.name,t.value,t.type))}),!n&&e&&e()},JSONFormData.prototype.fileToJSON=function(t,e,o){var a=this,n=t.length-1;t.length>-1?(a.formData[e]=[],[].forEach.call(t,function(t,r){if(t.size>5242880)return o({message:"One or more files is >5MB"});var i=new FileReader;i.readAsDataURL(t),i.addEventListener("loadend",function(){a.formData[e].push({type:t.type,name:t.name,body:i.result.split("base64,")[1]}),r===n&&o(null)},!1)})):o({message:"No files has been found!"})},JSONFormData.prototype.toUrlEncoded=function(t){var e,o=[],a=/%20/g;if(t instanceof Array)for(var n in t)this.appendUrlEncoded(n,t[n],o);else for(var r in t)this.buildParams(r,t[r],o);return e=o.join("&").replace(a,"+")},JSONFormData.prototype.appendUrlEncoded=function(t,e,o){e="function"==typeof e?e():null===e?"":e,o[o.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)},JSONFormData.prototype.buildParams=function(t,e,o){var a,n,r,i;if(i=/\[\]$/,e instanceof Array)for(n=0,r=e.length;r>n;n++)i.test(t)?this.appendUrlEncoded(t,e[n],o):this.buildParams(t+"["+("object"==typeof e[n]?n:"")+"]",e[n],o);else if("object"==typeof e)for(a in e)this.buildParams(t+"["+a+"]",e[a],o);else this.appendUrlEncoded(t,e,o)},JSONFormData.prototype.getMethod=function(){var t=this.form.getAttribute("method")||"get";return t.toLowerCase()}}(window);